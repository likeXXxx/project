# 出包脚本编写说明  

## 创建kubernetes.yaml文件  
根据deployment.yaml文件创建kubernetes.yaml文件, 指定其中命名空间, 应用名, 镜像名称等参数, 镜像名称使用registry.cluster.local这种域名.

## Makefile中添加如下脚本  
注意: 只能在执行make package之后才能执行此脚本, 并确保其在jenkins的 build工程中被调用
```
	bash ./hack/package.sh ${package}
	@echo -e building venus package: [${GREEN}${module}:${version}${NC}]
	rm -rf ${module} *.tgz
	mkdir ${module}
	# kubernetes.yaml
	sed 's/{{ tag }}/${image_tag}/g' kubernetes.yaml > ${module}/kubernetes.yaml
	# manifest.json
	echo '{"name":"${module}","git_commit":"${image_tag}","desc":"${desc}","deployments": ["kubernetes.yaml"],"images": ["${module}-${image_tag}.tar"],"version": "${version}","icon": "${icon}"}' > ${module}/manifest.json
	# docker save
	docker tag ${package} ${pk}
	docker save -o ${module}/${module}-${image_tag}.tar ${pk}
	# do package
	tar zcf ${module}-${image_tag}.tgz ${module}/*
```
注意: 其中变量参照venus-plugin-app工程[Makefile](http://git.ghostcloud.cn/venus/venus-plugin-app/blob/dev/Makefile)中的变量定义.

## 更新Jenkins  
参照[venus-plugin-app工程](http://192.168.25.101:31080/job/venus/job/venus-plugin-app/), 添加package项目, 此项目主要完成将build归档的 包 复制到 指定主机.
